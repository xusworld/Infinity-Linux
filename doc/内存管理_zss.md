## 第8章 内存管理策略

### 基本概念

内存可以看作是由一个很大的字节数组来组成的，每个字节都有各自的地址（在以字节寻址系统中），字节是操作系统的最小寻址单元。CPU根据程序计数器的值从内存中提取指令，这些指令又可能引对特定内存地址的额外加载与存储（读取操作数或者转储计算结果）。

### 基本硬件

CPU可以直接访问的通用存储只有内存和处理器内置的寄存器，进程运行时的程序和数据都应预先加载到内存中。为了解决CPU处理速度和内存访问速度不匹配的问题，在CPU芯片上增加更快的内存称为**高速缓存**。

**基地址寄存器：**存储进程最小的合法的物理内存地址，防止影响其它的进程。

**界限地址寄存器：**指定了当前进程可访问空间的大小。

### 地址绑定

CPU根据地址获取指令执行，这里的地址是用户程序中的地址通常称为逻辑地址，**逻辑地址**描述的一般是同一个进程中不同指令之间的相对地址，例如地址0、1、2、3...，因此逻辑地址也称为**相对地址**。而进程实际上是存储在内存中的，其存储位置可以是任何可用的内存空间地址。那么在执行时就必须要知道指令所在的实际内存地址，称为**物理地址**（绝对地址）。因此，CPU执行根据地址获取指令时需要将逻辑地址转换为物理地址后才能获取到相应的指令。地址绑定就是从一个地址空间到另一个地址空间的映射，这里是**逻辑地址空间**到**物理地址空间**的映射。

#### 地址绑定的时机

* **编译时：**在编译阶段就固定进程在内存中的驻留地址，逻辑地址就是物理地址，该方式不够灵活；
* **加载时：**程序的地址都是相对地址，直到加载程序时才根据重定位寄存器的值绑定逻辑地址到物理地址上；
* **执行时：**程序可以在内存中移动，直到程序真正执行时才进行地址绑定。

### 连续内存分配

采用连续内存分配时，每个进程都位于一个连续的内存区域。

#### 固定分区分配

固定分区分配策略将内存分为多个固定大小的分区，每个分区中只存放一个进程，这些分区可以是大小相等的也可以是不等的。

**缺点：**1. 分区内会产生内部碎片；2. 可能无法运行较大的进程，进程所需空间大于最大分区的大小。

**内部碎片**是在分配给某一进程的内存空间中，该进程没有使用而且其它进程也无法使用的内存区域。

#### 可变分区分配

系统维护一个系统空闲分区表，记录多个可用空闲分区的起始地址和大小，在为进程分配内存时按需分配，空闲分区剩余的部分会变成新的空闲分区。当进程释放内存时，如果有相邻的空闲分区就会进行合并操作。

**缺点：**长时间后会产生小的无法使用的空闲分区，称为外部碎片。

**外部碎片**是在多个已分配的进程空间之间存在的较小的无法被利用的内存空间，外部碎片可以通过**紧缩**技术来解决，紧缩技术通过利用重定位寄存器在内存中移动进程，使多个进程的地址空间变成连续的。但是在内存中移动进程的代价较大。

### 非连续内存分配



